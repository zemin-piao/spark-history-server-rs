{% extends "base.html" %}
{% block title %}Cluster Overview - Spark Analytics{% endblock %}

{% block content %}
<div class="filters">
    <div class="filter-group">
        <label>Time Range</label>
        <select id="timeRange">
            <option value="1h">Last Hour</option>
            <option value="24h" selected>Last 24 Hours</option>
            <option value="7d">Last 7 Days</option>
            <option value="30d">Last 30 Days</option>
        </select>
    </div>
    <div class="filter-group">
        <label>Refresh</label>
        <button onclick="window.location.reload()" style="padding: 0.5rem 1rem; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Refresh</button>
    </div>
</div>

<!-- Resource Utilization Overview -->
<div class="metrics-grid">
    <div class="metric-card">
        <div class="metric-value">{{ cluster_stats.cpu_utilization }}%</div>
        <div class="metric-label">CPU Utilization</div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: {{ cluster_stats.cpu_utilization }}%"></div>
        </div>
    </div>
    <div class="metric-card">
        <div class="metric-value">{{ cluster_stats.memory_utilization }}%</div>
        <div class="metric-label">Memory Utilization</div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: {{ cluster_stats.memory_utilization }}%"></div>
        </div>
    </div>
    <div class="metric-card">
        <div class="metric-value">{{ cluster_stats.active_applications }}</div>
        <div class="metric-label">Active Applications</div>
    </div>
    <div class="metric-card">
        <div class="metric-value">{{ cluster_stats.total_cores }}</div>
        <div class="metric-label">Total CPU Cores</div>
    </div>
</div>

<!-- Active Applications -->
<div class="card">
    <h2>Active Applications</h2>
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Application ID</th>
                    <th>User</th>
                    <th>Name</th>
                    <th>Duration</th>
                    <th>Resources</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for app in active_applications %}
                <tr>
                    <td><a href="/api/v1/applications/{{ app.id }}" target="_blank" style="color: #3498db; text-decoration: none;">{{ app.id }}</a></td>
                    <td>{{ app.user }}</td>
                    <td>{{ app.name }}</td>
                    <td>{{ app.duration }}</td>
                    <td>{{ app.cores }} cores, {{ app.memory }}GB</td>
                    <td>
                        <span class="status-badge status-{{ app.status|lower }}">
                            {{ app.status }}
                        </span>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" style="text-align: center; color: #999; padding: 2rem;">No active applications</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Recent Completed Applications -->
<div class="card">
    <h2>Recently Completed</h2>
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Application ID</th>
                    <th>User</th>
                    <th>Name</th>
                    <th>Runtime</th>
                    <th>Status</th>
                    <th>Ended</th>
                </tr>
            </thead>
            <tbody>
                {% for app in recent_applications %}
                <tr>
                    <td><a href="/api/v1/applications/{{ app.id }}" target="_blank" style="color: #3498db; text-decoration: none;">{{ app.id }}</a></td>
                    <td>{{ app.user }}</td>
                    <td>{{ app.name }}</td>
                    <td>{{ app.duration }}</td>
                    <td>
                        <span class="status-badge status-{{ app.status|lower }}">
                            {{ app.status }}
                        </span>
                    </td>
                    <td>{{ app.end_time }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" style="text-align: center; color: #999; padding: 2rem;">No recent applications</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Quick Stats -->
<div class="metrics-grid">
    <div class="metric-card" style="border-left-color: #e74c3c;">
        <div class="metric-value">{{ cluster_stats.failed_jobs_today }}</div>
        <div class="metric-label">Failed Jobs Today</div>
    </div>
    <div class="metric-card" style="border-left-color: #f39c12;">
        <div class="metric-value">{{ cluster_stats.avg_job_duration }}</div>
        <div class="metric-label">Avg Job Duration</div>
    </div>
    <div class="metric-card" style="border-left-color: #27ae60;">
        <div class="metric-value">{{ cluster_stats.jobs_completed_today }}</div>
        <div class="metric-label">Jobs Completed Today</div>
    </div>
    <div class="metric-card" style="border-left-color: #9b59b6;">
        <div class="metric-value">{{ cluster_stats.total_users }}</div>
        <div class="metric-label">Active Users</div>
    </div>
</div>

<script>
// Time range filter handler
document.getElementById('timeRange').addEventListener('change', function() {
    const range = this.value;
    window.location.href = `/?range=${range}`;
});
</script>
{% endblock %}